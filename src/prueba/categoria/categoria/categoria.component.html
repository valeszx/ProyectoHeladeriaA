<div class="header-container">
    <h1 class="page-title">Categorias</h1>
</div>

<button mat-flat-button color="primary" (click)="agregarProducto()" *ngIf="PuedeVer">
    Agregar
</button>

<div class="mat-elevation-z2 table-container">
    <table mat-table [dataSource]="dataSource">

        <ng-container matColumnDef="menu">
            <th mat-header-cell *matHeaderCellDef> </th>
            <td mat-cell *matCellDef="let element">
                <mat-icon class="dots-icon">more_vert</mat-icon>
            </td>
        </ng-container>

        <ng-container matColumnDef="Nombre">
            <th mat-header-cell *matHeaderCellDef> Nombre </th>
            <td mat-cell *matCellDef="let element"> {{element.nombre}} </td>
        </ng-container>

        <ng-container matColumnDef="TipoCategoria">
            <th mat-header-cell *matHeaderCellDef> Tipo Categoria </th>
            <td mat-cell *matCellDef="let element"> {{element.tipoCategoria}} </td>
        </ng-container>

        <ng-container matColumnDef="Imagen">
            <th mat-header-cell *matHeaderCellDef> Imagen </th>
            <td mat-cell *matCellDef="let element">
                <img [src]="element.rutaImagen"  class="table-image">
            </td>
        </ng-container>

        <!-- NUEVO: Editar -->
        <ng-container matColumnDef="Editar">
            <th mat-header-cell *matHeaderCellDef class="centered"> </th>
            <td mat-cell *matCellDef="let element" class="centered">
                <button mat-icon-button color="primary" aria-label="Editar producto" matTooltip="Editar"
                    (click)='editarProducto(element)' *ngIf="PuedeVer">
                    <mat-icon>edit</mat-icon>
                </button>
            </td>
        </ng-container>

        <!-- NUEVO: Eliminar -->
        <ng-container matColumnDef="Eliminar">
            <th mat-header-cell *matHeaderCellDef class="centered"> </th>
            <td mat-cell *matCellDef="let element" class="centered">
                <button mat-icon-button color="warn" aria-label="Eliminar producto" matTooltip="Eliminar"
                    (click)="EliminarProducto(element)" *ngIf="PuedeVer">
                    <mat-icon>delete</mat-icon>
                </button>
            </td>
        </ng-container>


        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="data-row"></tr>
    </table>
</div>

<mat-paginator [pageSizeOptions]="[4, 10, 25]" showFirstLastButtons></mat-paginator>

<div class="modal-overlay" (click)="cancelar()" *ngIf="Modal">
    <div class="modal-dialog" (click)="$event.stopPropagation()">

        <div class="modal-header">
            <h2 class="modal-title">{{titulo}}</h2>
        </div>

        <div class="modal-content">
            <form [formGroup]="formulario">
                <div class="form-group">
                    <label>Nombre</label>
                    <input type="text" formControlName="nombre" required>
                    <span class="error-msg"
                        *ngIf="formulario.get('nombre')?.invalid && formulario.get('nombre')?.touched">El nombre es
                        obligatorio.</span>
                </div>

                <div class="form-group">
                    <label>Tipo Categoria</label>
                    <input type="text" formControlName="tipoCategoria" required>
                    <span class="error-msg"
                        *ngIf="formulario.get('tipoCategoria')?.invalid && formulario.get('tipoCategoria')?.touched">El
                        tipo de categoria es
                        obligatorio.</span>
                </div>

                <div class="form-group">
                    <label>Imagen</label>
                    <input type="file" #fileInput hidden (change)="onFileSelected($event)">

                    <button mat-flat-button color="accent" type="button" (click)="fileInput.click()">
                        Seleccionar Imagen
                    </button>
                </div>

                <div class="form-group image-preview-container" *ngIf="imagePreview">
                    <label>Previsualización</label>
                    <img [src]="imagePreview" alt="Previsualización de la imagen" class="image-preview">
                </div>


            </form>
        </div>

        <div class="modal-actions">
            <button class="btn btn-secondary" (click)="cancelar()">Cancelar</button>
            <button class="btn btn-primary" [disabled]="formulario.invalid" (click)="guardar()">Agregar</button>
        </div>

    </div>
</div>

<div class="modal-overlay" (click)="cancelar()" *ngIf="ModalEliminar">
    <div class="modal-dialog" (click)="$event.stopPropagation()">

        <div class="modal-header">
            <h2 class="modal-title">{{tituloEliminar}}</h2>
        </div>

        <div class="modal-content">
            <p>¿Desea eliminar la categoria?</p>
        </div>

        <div class="modal-actions">
            <button class="btn btn-secondary" (click)="CancelarEliminar()">Cancelar</button>
            <button class="btn btn-danger" (click)="eliminar()">Aceptar</button>
        </div>

    </div>
</div>